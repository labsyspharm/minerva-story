<!DOCTYPE html>
<html lang="en-US" class="h-100">

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
</head>

<body>
    <div id="minerva-browser" class="h-100"> </div>
    <script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js" integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.3.1/openseadragon.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.8.6/showdown.min.js"></script>
    <script src="https://api.html5media.info/1.2.2/html5media.min.js"></script>

    <script src="includes/openseadragon-scalebar.js"></script>
    <script src="includes/openseadragon-svg-overlay.js"></script>
    <script src="includes/bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
    <script>
        const speech_bucket = "";
        const authenticate = function(username, pass) {

          const authenticateUser = function(cognitoUser, authenticationDetails) {
            return new Promise(function(resolve, reject) {
              cognitoUser.authenticateUser(authenticationDetails, {
                onSuccess: result => resolve(result),
                onFailure: err => reject(err),
                mfaRequired: codeDeliveryDetails => reject(codeDeliveryDetails),
                newPasswordRequired: (fields, required) => reject({fields, required})
              });
            });
          };

          return pass.then(function(password) {

            const minervaPoolId = 'us-east-1_d3Wusx6qp';
            const minervaClientId = 'cvuuuuogh6nmqm8491iiu1lh5';
            const minervaPool = new CognitoUserPool({
              UserPoolId : minervaPoolId,
              ClientId : minervaClientId
            });

            const cognitoUser = new CognitoUser({
              Username: username,
              Pool: minervaPool
            });

            const authenticationDetails = new AuthenticationDetails({
              Username: username,
              Password: password
            });

            return authenticateUser(cognitoUser, authenticationDetails)
              .then(response => response.getIdToken().getJwtToken());
          });
        }

        window.viewer = MinervaStory.default.build_page({
          authenticate: authenticate,
          speech_bucket: speech_bucket,
          exhibit: "includes/exhibit.json",
          id: "minerva-browser",
          embedded: true
        });
    </script>
</body>
</html>
